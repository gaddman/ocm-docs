/**************************************************************************
-- -Generated by xSQL Schema Compare
-- -Date/Time: Feb 04 2014, 11:14:08 AM

-- -Summary:
    T-SQL script that makes the schema of the database [(local)\SQLEXPRESS].[OCM_Staging] 
    the same as the schema of the database [(local)\SQLEXPRESS].[OCM_Live].

-- -Action:
    Execute this script on [(local)\SQLEXPRESS].[OCM_Staging].

    **** BACKUP the database [(local)\SQLEXPRESS].[OCM_Staging] before running this script ****

-- -Source SQL Server version: 11.0.2218.0
-- -Target SQL Server version: 11.0.2218.0
**************************************************************************/

UPDATE AddressInfo SET Latitude=0,Longitude=0 WHERE Latitude IS NULL OR Longitude IS NULL
UPDATE AddressInfo set CountryID=1 where CountryID IS NULL

USE OCM_Live
GO

SET QUOTED_IDENTIFIER ON
SET ANSI_NULLS ON
SET ANSI_PADDING ON
SET ANSI_WARNINGS ON
SET ARITHABORT ON
SET NUMERIC_ROUNDABORT OFF
SET CONCAT_NULL_YIELDS_NULL ON
SET XACT_ABORT ON
GO


BEGIN TRANSACTION
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[AddressInfo] DROP CONSTRAINT [FK_AddressInfo_Country]
GO

DROP INDEX [IX_AddressLocation] ON [dbo].[AddressInfo]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[AddressInfo] ALTER COLUMN [CountryID] [int] NOT NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[UsageType] ADD [IsPublicAccess] [bit] NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[UserComment] ADD [Latitude] [float](53) NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[AddressInfo] ALTER COLUMN [Latitude] [float](53) NOT NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[UserComment] ADD [Longitude] [float](53) NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[AddressInfo] ALTER COLUMN [Longitude] [float](53) NOT NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[User] ADD [ReceiveCommentNotifications] [bit] CONSTRAINT [DF_User_ReceiveCommentNotifications] DEFAULT ((0)) NOT NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[User] ADD [ReceiveEditNotifications] [bit] CONSTRAINT [DF_User_ReceiveEditNotifications] DEFAULT ((0)) NOT NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[AddressInfo] ALTER COLUMN [Title] [nvarchar](100) COLLATE Latin1_General_CI_AS NOT NULL
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RegisteredApplication]
(
	[ID] [int] IDENTITY(1,1),
	[Title] [nvarchar](100) COLLATE Latin1_General_CI_AS NOT NULL,
	[WebsiteURL] [nvarchar](500) COLLATE Latin1_General_CI_AS NOT NULL,
	[Description] [nvarchar](max) COLLATE Latin1_General_CI_AS NULL,
	[IsEnabled] [bit] NOT NULL,
	[IsWriteEnabled] [bit] NOT NULL,
	[PrimaryAPIKey] [nvarchar](100) COLLATE Latin1_General_CI_AS NOT NULL,
	[DeprecatedAPIKey] [nvarchar](100) COLLATE Latin1_General_CI_AS NULL,
	[SharedSecret] [nvarchar](100) COLLATE Latin1_General_CI_AS NOT NULL,
	[DateAPIKeyLastUsed] [datetime] NULL,
	[DateCreated] [datetime] NOT NULL,
	[UserID] [int] NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[UsageType] ADD CONSTRAINT [DF_UsageType_IsPublicAccess] DEFAULT ((0)) FOR [IsPublicAccess]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[RegisteredApplication] ADD CONSTRAINT [DF_Application_IsEnabled] DEFAULT ((0)) FOR [IsEnabled]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[RegisteredApplication] ADD CONSTRAINT [DF_Application_IsWriteEnabled] DEFAULT ((0)) FOR [IsWriteEnabled]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[OperatorCountry]
(
	[ID] [int] IDENTITY(1,1),
	[OperatorID] [int] NOT NULL,
	[CountryID] [int] NOT NULL
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[RegisteredApplication] ADD CONSTRAINT [PK_Application] PRIMARY KEY CLUSTERED
(
	[ID] ASC
)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[OperatorCountry] ADD CONSTRAINT [PK_OperatorCountry] PRIMARY KEY CLUSTERED
(
	[ID] ASC
)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_AddressLocation] ON [dbo].[AddressInfo]
(
	[Latitude] ASC, [Longitude] ASC
)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[AddressInfo] WITH CHECK ADD CONSTRAINT [FK_AddressInfo_Country] FOREIGN KEY
(
	[CountryID]
)
REFERENCES [dbo].[Country]
(
	[ID]
)
ON DELETE NO ACTION
ON UPDATE NO ACTION
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[RegisteredApplication] WITH CHECK ADD CONSTRAINT [FK_RegisteredApplication_User] FOREIGN KEY
(
	[UserID]
)
REFERENCES [dbo].[User]
(
	[ID]
)
ON DELETE NO ACTION
ON UPDATE NO ACTION
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[OperatorCountry] WITH CHECK ADD CONSTRAINT [FK_OperatorCountry_Country] FOREIGN KEY
(
	[CountryID]
)
REFERENCES [dbo].[Country]
(
	[ID]
)
ON DELETE NO ACTION
ON UPDATE NO ACTION
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
ALTER TABLE [dbo].[OperatorCountry] WITH CHECK ADD CONSTRAINT [FK_OperatorCountry_Operator] FOREIGN KEY
(
	[OperatorID]
)
REFERENCES [dbo].[Operator]
(
	[ID]
)
ON DELETE NO ACTION
ON UPDATE NO ACTION
GO


COMMIT TRANSACTION
GO


